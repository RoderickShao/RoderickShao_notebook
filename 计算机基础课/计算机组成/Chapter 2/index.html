
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="RoderickShao's NoteBook">
      
      
        <meta name="author" content="RoderickShao">
      
      
      
        <link rel="prev" href="../Chapter%201/">
      
      
        <link rel="next" href="../Chapter%203/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.2.0-b3">
    
    
      
        <title>2 Chapter 2 - RoderickShao's NoteBook</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.83068744.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config",""),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2-instructions-language-of-the-machine" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="RoderickShao&#39;s NoteBook" class="md-header__button md-logo" aria-label="RoderickShao's NoteBook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RoderickShao's NoteBook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2 Chapter 2
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="关闭自动模式"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="关闭自动模式" for="__palette_3" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="default" data-md-color-accent="blue"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_3">
            
              <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/RoderickShao/RoderickShao_notebook" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RoderickShao_notebook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E9%80%9A%E8%AF%86%E5%9F%BA%E7%A1%80%E8%AF%BE/Introduction/" class="md-tabs__link">
          
  
    
  
  通识基础课

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../Introduction/" class="md-tabs__link">
          
  
    
  
  计算机基础课

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/Introduction/" class="md-tabs__link">
          
  
    
  
  计算机语言学习

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3%E6%8A%80%E8%83%BD/Introduction/" class="md-tabs__link">
          
  
    
  
  计算机相关技能

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%9B%BE%E5%BD%A2%E5%AD%A6%E8%AF%BE%E7%A8%8B/Introduction/" class="md-tabs__link">
          
  
    
  
  图形学课程

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="RoderickShao&#39;s NoteBook" class="md-nav__button md-logo" aria-label="RoderickShao's NoteBook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    RoderickShao's NoteBook
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/RoderickShao/RoderickShao_notebook" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    RoderickShao_notebook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E9%80%9A%E8%AF%86%E5%9F%BA%E7%A1%80%E8%AF%BE/Introduction/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    通识基础课
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计算机基础课
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            计算机基础课
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91%E8%AE%BE%E8%AE%A1/1%20%E9%80%BB%E8%BE%91%E8%AE%A1%E7%AE%97%E4%B8%8E%E5%B8%83%E5%B0%94%E4%BB%A3%E6%95%B0/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    数字逻辑设计
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/Introduction/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    高级数据结构与算法分析
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计算机组成
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            计算机组成
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    0 Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%201/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Chapter 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    2 Chapter 2
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2 Chapter 2
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#21-introduction" class="md-nav__link">
    2.1 Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-arithmetic-operations" class="md-nav__link">
    2.2 Arithmetic Operations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#23-operands" class="md-nav__link">
    2.3 Operands
  </a>
  
    <nav class="md-nav" aria-label="2.3 Operands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-risc-v-registers" class="md-nav__link">
    2.1 RISC-V Registers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-memory-operands" class="md-nav__link">
    2.2 Memory Operands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-constant-or-immediate-operands" class="md-nav__link">
    2.3 Constant or Immediate Operands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#24-representing-instructions" class="md-nav__link">
    2.4 Representing Instructions
  </a>
  
    <nav class="md-nav" aria-label="2.4 Representing Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#241-risc-v-r-format-instructions" class="md-nav__link">
    2.4.1 RISC-V R-Format Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#242-risc-v-i-format-instructions" class="md-nav__link">
    2.4.2 RISC-V I-Format Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#243-risc-v-s-format-instructions" class="md-nav__link">
    2.4.3 RISC-V S-Format Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#244-from-c-to-machine-instruction" class="md-nav__link">
    2.4.4 From C to Machine Instruction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary_1" class="md-nav__link">
    Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#25-logical-operations" class="md-nav__link">
    2.5 Logical Operations
  </a>
  
    <nav class="md-nav" aria-label="2.5 Logical Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#251-shift-operations-i" class="md-nav__link">
    2.5.1 Shift Operations (I)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#252-and-operations" class="md-nav__link">
    2.5.2 AND Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#253-or-operations" class="md-nav__link">
    2.5.3 OR Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#254-xor-operations" class="md-nav__link">
    2.5.4 XOR Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary_2" class="md-nav__link">
    Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#26-instructions-for-making-decisions" class="md-nav__link">
    2.6 Instructions for making decisions
  </a>
  
    <nav class="md-nav" aria-label="2.6 Instructions for making decisions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#261-if" class="md-nav__link">
    2.6.1 if 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#262-if-then-else" class="md-nav__link">
    2.6.2 if-then-else 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#263-while" class="md-nav__link">
    2.6.3 While 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#264-switchcase" class="md-nav__link">
    2.6.4 Switch/Case 语句
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#27-supporting-procedures" class="md-nav__link">
    2.7 Supporting Procedures
  </a>
  
    <nav class="md-nav" aria-label="2.7 Supporting Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#procedure-call-instructions" class="md-nav__link">
    Procedure Call Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-more-registers" class="md-nav__link">
    Using More Registers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-layout" class="md-nav__link">
    Memory Layout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#28-communicating-with-people-charactor-data" class="md-nav__link">
    2.8 Communicating with People Charactor Data
  </a>
  
    <nav class="md-nav" aria-label="2.8 Communicating with People Charactor Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#281-some-character-sets" class="md-nav__link">
    2.8.1 Some character sets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#282-risc-v-bytehalfwordword-loadstore" class="md-nav__link">
    2.8.2 RISC-V byte/halfword/word load/store
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#29-addressing-for-32-bit-immediate-and-addresses" class="md-nav__link">
    2.9 Addressing for 32-bit Immediate and Addresses
  </a>
  
    <nav class="md-nav" aria-label="2.9 Addressing for 32-bit Immediate and Addresses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#291-addressing-for-32-bit-immediate" class="md-nav__link">
    2.9.1 Addressing for 32-bit Immediate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#292-branch-addressing" class="md-nav__link">
    2.9.2 Branch Addressing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#293-jump-addressing" class="md-nav__link">
    2.9.3 Jump Addressing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#294-risc-v-addressing-summary" class="md-nav__link">
    2.9.4 RISC-V Addressing Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#210-risc-v-disassembly" class="md-nav__link">
    2.10 RISC-V Disassembly
  </a>
  
    <nav class="md-nav" aria-label="2.10 RISC-V Disassembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#summary-of-risc-v-instruction-encoding" class="md-nav__link">
    Summary of RISC-V instruction encoding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#211-synchronization-in-risc-v" class="md-nav__link">
    2.11 Synchronization in RISC-V
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#212-translating-and-starting-a-program" class="md-nav__link">
    2.12 Translating and starting a program
  </a>
  
    <nav class="md-nav" aria-label="2.12 Translating and starting a program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2121-assembler" class="md-nav__link">
    2.12.1 Assembler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2122-linker" class="md-nav__link">
    2.12.2 Linker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2123-loader" class="md-nav__link">
    2.12.3 Loader
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2124-dynamic-linking" class="md-nav__link">
    2.12.4 Dynamic Linking
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2125-starting-java-applications" class="md-nav__link">
    2.12.5 Starting Java Applications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#213-arrays-versus-pointers" class="md-nav__link">
    2.13 Arrays versus Pointers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#214-real-stuff" class="md-nav__link">
    2.14* Real Stuff
  </a>
  
    <nav class="md-nav" aria-label="2.14* Real Stuff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2141-mips-instructions" class="md-nav__link">
    2.14.1 MIPS Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2142-the-intel-x86-isa" class="md-nav__link">
    2.14.2 The Intel x86 ISA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2143-other-risc-v-instructions" class="md-nav__link">
    2.14.3 Other RISC-V Instructions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#215-a-c-sort-example-to-put-it-all-together" class="md-nav__link">
    2.15 A C Sort Example To Put it All Together
  </a>
  
    <nav class="md-nav" aria-label="2.15 A C Sort Example To Put it All Together">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2151-procedure-swap" class="md-nav__link">
    2.15.1 Procedure swap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2152-procedure-sort" class="md-nav__link">
    2.15.2 Procedure sort
  </a>
  
    <nav class="md-nav" aria-label="2.15.2 Procedure sort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-outer-loop" class="md-nav__link">
    The Outer Loop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-inner-loop" class="md-nav__link">
    The Inner Loop
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2153-the-full-procedure" class="md-nav__link">
    2.15.3 The Full Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%203/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Chapter 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%204/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Chapter 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Appendix%201/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appendix 1
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/Introduction/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    计算机语言学习
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3%E6%8A%80%E8%83%BD/Introduction/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    计算机相关技能
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%9B%BE%E5%BD%A2%E5%AD%A6%E8%AF%BE%E7%A8%8B/Introduction/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    图形学课程
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#21-introduction" class="md-nav__link">
    2.1 Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#22-arithmetic-operations" class="md-nav__link">
    2.2 Arithmetic Operations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#23-operands" class="md-nav__link">
    2.3 Operands
  </a>
  
    <nav class="md-nav" aria-label="2.3 Operands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-risc-v-registers" class="md-nav__link">
    2.1 RISC-V Registers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-memory-operands" class="md-nav__link">
    2.2 Memory Operands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-constant-or-immediate-operands" class="md-nav__link">
    2.3 Constant or Immediate Operands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#24-representing-instructions" class="md-nav__link">
    2.4 Representing Instructions
  </a>
  
    <nav class="md-nav" aria-label="2.4 Representing Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#241-risc-v-r-format-instructions" class="md-nav__link">
    2.4.1 RISC-V R-Format Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#242-risc-v-i-format-instructions" class="md-nav__link">
    2.4.2 RISC-V I-Format Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#243-risc-v-s-format-instructions" class="md-nav__link">
    2.4.3 RISC-V S-Format Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#244-from-c-to-machine-instruction" class="md-nav__link">
    2.4.4 From C to Machine Instruction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary_1" class="md-nav__link">
    Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#25-logical-operations" class="md-nav__link">
    2.5 Logical Operations
  </a>
  
    <nav class="md-nav" aria-label="2.5 Logical Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#251-shift-operations-i" class="md-nav__link">
    2.5.1 Shift Operations (I)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#252-and-operations" class="md-nav__link">
    2.5.2 AND Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#253-or-operations" class="md-nav__link">
    2.5.3 OR Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#254-xor-operations" class="md-nav__link">
    2.5.4 XOR Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary_2" class="md-nav__link">
    Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#26-instructions-for-making-decisions" class="md-nav__link">
    2.6 Instructions for making decisions
  </a>
  
    <nav class="md-nav" aria-label="2.6 Instructions for making decisions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#261-if" class="md-nav__link">
    2.6.1 if 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#262-if-then-else" class="md-nav__link">
    2.6.2 if-then-else 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#263-while" class="md-nav__link">
    2.6.3 While 语句
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#264-switchcase" class="md-nav__link">
    2.6.4 Switch/Case 语句
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#27-supporting-procedures" class="md-nav__link">
    2.7 Supporting Procedures
  </a>
  
    <nav class="md-nav" aria-label="2.7 Supporting Procedures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#procedure-call-instructions" class="md-nav__link">
    Procedure Call Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-more-registers" class="md-nav__link">
    Using More Registers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-layout" class="md-nav__link">
    Memory Layout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#28-communicating-with-people-charactor-data" class="md-nav__link">
    2.8 Communicating with People Charactor Data
  </a>
  
    <nav class="md-nav" aria-label="2.8 Communicating with People Charactor Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#281-some-character-sets" class="md-nav__link">
    2.8.1 Some character sets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#282-risc-v-bytehalfwordword-loadstore" class="md-nav__link">
    2.8.2 RISC-V byte/halfword/word load/store
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#29-addressing-for-32-bit-immediate-and-addresses" class="md-nav__link">
    2.9 Addressing for 32-bit Immediate and Addresses
  </a>
  
    <nav class="md-nav" aria-label="2.9 Addressing for 32-bit Immediate and Addresses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#291-addressing-for-32-bit-immediate" class="md-nav__link">
    2.9.1 Addressing for 32-bit Immediate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#292-branch-addressing" class="md-nav__link">
    2.9.2 Branch Addressing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#293-jump-addressing" class="md-nav__link">
    2.9.3 Jump Addressing
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#294-risc-v-addressing-summary" class="md-nav__link">
    2.9.4 RISC-V Addressing Summary
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#210-risc-v-disassembly" class="md-nav__link">
    2.10 RISC-V Disassembly
  </a>
  
    <nav class="md-nav" aria-label="2.10 RISC-V Disassembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#summary-of-risc-v-instruction-encoding" class="md-nav__link">
    Summary of RISC-V instruction encoding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#211-synchronization-in-risc-v" class="md-nav__link">
    2.11 Synchronization in RISC-V
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#212-translating-and-starting-a-program" class="md-nav__link">
    2.12 Translating and starting a program
  </a>
  
    <nav class="md-nav" aria-label="2.12 Translating and starting a program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2121-assembler" class="md-nav__link">
    2.12.1 Assembler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2122-linker" class="md-nav__link">
    2.12.2 Linker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2123-loader" class="md-nav__link">
    2.12.3 Loader
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2124-dynamic-linking" class="md-nav__link">
    2.12.4 Dynamic Linking
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2125-starting-java-applications" class="md-nav__link">
    2.12.5 Starting Java Applications
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#213-arrays-versus-pointers" class="md-nav__link">
    2.13 Arrays versus Pointers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#214-real-stuff" class="md-nav__link">
    2.14* Real Stuff
  </a>
  
    <nav class="md-nav" aria-label="2.14* Real Stuff">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2141-mips-instructions" class="md-nav__link">
    2.14.1 MIPS Instructions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2142-the-intel-x86-isa" class="md-nav__link">
    2.14.2 The Intel x86 ISA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2143-other-risc-v-instructions" class="md-nav__link">
    2.14.3 Other RISC-V Instructions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#215-a-c-sort-example-to-put-it-all-together" class="md-nav__link">
    2.15 A C Sort Example To Put it All Together
  </a>
  
    <nav class="md-nav" aria-label="2.15 A C Sort Example To Put it All Together">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2151-procedure-swap" class="md-nav__link">
    2.15.1 Procedure swap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2152-procedure-sort" class="md-nav__link">
    2.15.2 Procedure sort
  </a>
  
    <nav class="md-nav" aria-label="2.15.2 Procedure sort">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-outer-loop" class="md-nav__link">
    The Outer Loop
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-inner-loop" class="md-nav__link">
    The Inner Loop
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2153-the-full-procedure" class="md-nav__link">
    2.15.3 The Full Procedure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="2-instructions-language-of-the-machine"><strong>2 Instructions: Language of the Machine</strong><a class="headerlink" href="#2-instructions-language-of-the-machine" title="Permanent link">&para;</a></h1>
<p>The process of compiling </p>
<ul>
<li>High-level programming language</li>
</ul>
<p>用更自然的语言叙述，编译器将它翻译成汇编语言。与汇编语言相比，高级编程语言对于硬件来说更加独立。</p>
<ul>
<li>Assembly language</li>
</ul>
<p>Assembler 将它翻译为机器指令</p>
<ul>
<li>Machine language</li>
</ul>
<h2 id="21-introduction"><strong>2.1 Introduction</strong><a class="headerlink" href="#21-introduction" title="Permanent link">&para;</a></h2>
<p>Language of the machine </p>
<ul>
<li>Instructions  <span class="arithmatex">\(\rightarrow\)</span> Word</li>
<li>Instruction set  <span class="arithmatex">\(\rightarrow\)</span> Vocabulary</li>
</ul>
<p>我们选择的指令集是RISV-V</p>
<p><strong>Instruction Set</strong></p>
<p>CISC vs. RISC</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CISC</th>
<th style="text-align: left;">RISC</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Emphasis on hardware(&gt;200 instructions)</td>
<td style="text-align: left;">Emphasis on software(&lt;100 instructions)</td>
</tr>
<tr>
<td style="text-align: left;">Multiple instruction sizes and formats</td>
<td style="text-align: left;">Instructions of same size with few formats</td>
</tr>
<tr>
<td style="text-align: left;">Less registers</td>
<td style="text-align: left;">Uses more registers</td>
</tr>
<tr>
<td style="text-align: left;">More addressing modes</td>
<td style="text-align: left;">Fewer addressing modes(Load/Store)</td>
</tr>
<tr>
<td style="text-align: left;">Extensive use of microprogramming</td>
<td style="text-align: left;">Complexity in compiler</td>
</tr>
<tr>
<td style="text-align: left;">Instructions take a varying amount of cycle time</td>
<td style="text-align: left;">Instructions take one cycle time</td>
</tr>
<tr>
<td style="text-align: left;">Pipelining is difficult</td>
<td style="text-align: left;">Pipelining is easy</td>
</tr>
</tbody>
</table>
<p><strong>Instruction formats</strong></p>
<p>一条指令由Operators与Operands构成</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20113017.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20113017.png" /></a></p>
<p><strong>Stored-program concept</strong></p>
<ul>
<li>Instruction are represented as numbers.</li>
<li>Programs can be stored in memory to be read  or written just like numbers.</li>
</ul>
<h2 id="22-arithmetic-operations"><strong>2.2 Arithmetic Operations</strong><a class="headerlink" href="#22-arithmetic-operations" title="Permanent link">&para;</a></h2>
<p>Each line of this language can contain at most one instruction.</p>
<p>Add and subtract, three operands, like <strong>add a,b,c   // a gets b+c</strong></p>
<p>All arithmetic operations have this form, 固定了运算数的数量，对硬件的实现更加容易。</p>
<div class="admonition note">
<p class="admonition-title">Design Principle 1: Simplicity favors regularity</p>
<p>Regularity makes implementation simpler</br>
Simplicity enables higher performance at lower cost</p>
</div>
<div class="admonition example">
<p class="admonition-title">Arithmetic Example</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20140021.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20140021.png" /></a></p>
</div>
<h2 id="23-operands"><strong>2.3 Operands</strong><a class="headerlink" href="#23-operands" title="Permanent link">&para;</a></h2>
<p>Arithmetic instructions use <strong>register operands</strong></p>
<p>RISC-V has a <span class="arithmatex">\(32\times 64\)</span> -bit register file</p>
<ul>
<li>Use for frequently accessed data</li>
<li>64-bit data is called a “double word”</li>
<li>32-bit data is called a ”word”</li>
</ul>
<p><span class="arithmatex">\(32\times 64\)</span>-<span class="arithmatex">\(bit\)</span> :32个寄存器，每个寄存器是64位的</p>
<div class="admonition note">
<p class="admonition-title">Design Principle 2: Smaller is faster</p>
<p>A very large number of registers may increase the clock cycle time  simply because it takes electronic singnals longer when they must   travel farther, 但是这话也并不绝对,31位寄存器就不见得比32位的快，我们需要在craving of programs for more registers 和the designer's desire to keep the clock fast 之间找到平衡。</p>
</div>
<h3 id="21-risc-v-registers"><strong>2.1 RISC-V Registers</strong><a class="headerlink" href="#21-risc-v-registers" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20115653.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20115653.png" /></a></p>
<div class="admonition example">
<p class="admonition-title">Register Operand Example</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20141724.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20141724.png" /></a></p>
</div>
<h3 id="22-memory-operands"><strong>2.2 Memory Operands</strong><a class="headerlink" href="#22-memory-operands" title="Permanent link">&para;</a></h3>
<p>处理器只能保留一小部分数据在寄存器中，大部分数据结构被存储在了内存当中。而Arithmetic operations occur on register in RISC-V instructions，所以RISC-V需要有相关指令来在内存和寄存器之间传输数据，这些指令被称为data transfer instruction。</p>
<ul>
<li>Main memory used for composite data, such as Arrays, structures, dynamic data</li>
<li>Memory is byte addressed, each address identifies an 8-bit byte</li>
<li>RISC-V is Little Endian. It means least-significant byte at least address of a word</li>
<li>RISC-V does not require words to be aligned in memory</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Memory Alignment</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20191124.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20191124.png" /></a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Endianness/byte order</p>
<p>Big end: leftmost.典型例子有PowerPC，01 02就是513（后面的位置更大）</p>
<p>Little end: Rightmost.典型例子有RISC-V，01 02就是258</p>
<p>Bi-endian 有MIPS,ARM，Alpha,SPARC</p>
</div>
<div class="admonition example">
<p class="admonition-title">Memory Operand Example</p>
<p>C code: <code>A[12]=h+A[8];</code></p>
<p>Compiled RISC-V code:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>ld      x9, 64(x22)
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>add     x9,x21,x9
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>sd      x9,96(x22)
</code></pre></div>
其中h在x21中，base address of A 存在x22中</p>
<ul>
<li>
<p>offset:偏移量，the constant in a data transfer instruction</p>
</li>
<li>
<p>base register: the register addded to form address,在这里就是x22</p>
</li>
<li>
<p>ld: standing for load doubleword</p>
</li>
<li>
<p>sd: standing for store doubleword</p>
</li>
</ul>
</div>
<p><strong>Register vs. Memory</strong></p>
<ol>
<li>Registers are faster to access than memory</li>
<li>Operating on memory data requires <strong>loads and stores</strong>  with more instructions to be executed</li>
<li>Compiler must use registers for variables as much as possible, only spill to memory for less frequently used variables</li>
</ol>
<h3 id="23-constant-or-immediate-operands"><strong>2.3 Constant or Immediate Operands</strong><a class="headerlink" href="#23-constant-or-immediate-operands" title="Permanent link">&para;</a></h3>
<p>Many time a program will use a constant in an operation</p>
<ul>
<li>Incrementing index to point to next element of array</li>
<li>Add the constant 4 to register x9</li>
<li>Assuming <code>AddrConstants4</code> is address pointer of constant 4</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>ld      x9, AddrConstant4(x3) // x9=constant 4
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>add     x22, x22, x9
</code></pre></div>
<p><code>x3+ AddrConstants4</code>是常数4在内存上的地址</p>
<p>另一个不用load指令的方法是引入一个新的arithmetic instruction专门处理有运算数为常数的。这个新的arithmetic instruction 被称为add immediate or <strong>addi</strong>, 于是相应的代码就可以这样写。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>addi x22, x22, 4 // x22= x22 + 4
</code></pre></div>
<p>addi 是几乎所有RISC-V程序中最为常见的指令。</p>
<p>常数0有另一个作用，它可以简化指令集。比如说要对一个值进行取反可以直接使用0作为sub运算的第一个运算符。所以RISC-V将寄存器x0设定值为0。这体现了<strong>Design Principle 3: Make common case fast</strong></p>
<h3 id="summary"><strong>Summary</strong><a class="headerlink" href="#summary" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20221632.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-08%20221632.png" /></a></p>
<h2 id="24-representing-instructions"><strong>2.4 Representing Instructions</strong><a class="headerlink" href="#24-representing-instructions" title="Permanent link">&para;</a></h2>
<h3 id="241-risc-v-r-format-instructions"><strong>2.4.1 RISC-V R-Format Instructions</strong><a class="headerlink" href="#241-risc-v-r-format-instructions" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20102537.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20102537.png" /></a></p>
<ul>
<li>opcode: operation code</li>
<li>rd: destination register number</li>
<li>funct3: 3-bit function code (additonal opcode)</li>
<li>rs1: the first source register number</li>
<li>rs2: the second  source register number</li>
<li>funct7: 7-bit function code (additonal opcode)</li>
</ul>
<div class="admonition example">
<p class="admonition-title">R-Format Instruction</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20103158.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20103158.png" /></a></p>
</div>
<h3 id="242-risc-v-i-format-instructions"><strong>2.4.2 RISC-V I-Format Instructions</strong><a class="headerlink" href="#242-risc-v-i-format-instructions" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20103426.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20103426.png" /></a></p>
<ul>
<li>
<p>rs1: source or base address register number</p>
</li>
<li>
<p>immediate: constant operand, or offset added to base address (2s-complement, sign extended)</p>
</li>
</ul>
<p>这里就可以解答前面R型指令<strong>为什么要把rs2放在rs1前面</strong>，因为这样可以保证不同指令结构相似，只需要将R型指令的funct7和rs2读成一个immediate.</p>
<p>这个指令同时可以完成ld指令，只需要把rs1设为基地址和immediate设为偏移量，rd还是目标寄存器</p>
<div class="admonition example">
<p class="admonition-title">I-Format Instruction</p>
<p>ld x9, 64(x22)
- 22 (x22) is placed in rs1;
- 64 is placed in immediate
- 9 (x9) is placed in rd</p>
</div>
<h3 id="243-risc-v-s-format-instructions"><strong>2.4.3 RISC-V S-Format Instructions</strong><a class="headerlink" href="#243-risc-v-s-format-instructions" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20104428.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20104428.png" /></a></p>
<ul>
<li>
<p>rs1: base address register number</p>
</li>
<li>
<p>rs2: source operand register number</p>
</li>
<li>
<p>immediate: offset added to base address (Split so that rs1 and rs2 fields always in the same place)</p>
</li>
</ul>
<p>特意设置一种S-Format是因为S型和I型数据的流动方向并不一样，I型是rs1+immediate到rd，R型是rs2到rs1+immediate。</p>
<h3 id="244-from-c-to-machine-instruction"><strong>2.4.4 From C to Machine Instruction</strong><a class="headerlink" href="#244-from-c-to-machine-instruction" title="Permanent link">&para;</a></h3>
<p>C code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">A</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>RISC-V assembly code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>ld x9, 240(x10) // temporary reg x9 gets A[30]
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>add x9, x21, x9 // temporary reg x9 gets h + A[30]
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>addi x9, x9, 1 // temporary reg x9 gets h + A[30] + 1
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>sd x9, 240(x10) // stores h + A[30] + 1 back into A[30]
</code></pre></div>
<p>RISC-V machine language code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>ld | immediate | rs1 | funct3 | rd | opcode |
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>        240      10     3       9      3
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>add | funct7 | rs2 | rs1 | funct3 | rd | opcode |
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>        0       9    21      0      9      51
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>addi | immediate | rs1 | funct3 | rd | opcode |
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>           1        9      0      9      19
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>sd | im[11:5] | rs2 | rs1 | funct3 | im[4:0] | opcode |
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>         7       9    10      3        16        35
</code></pre></div>
<h3 id="summary_1"><strong>Summary</strong><a class="headerlink" href="#summary_1" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20111305.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20111305.png" /></a></p>
<h2 id="25-logical-operations"><strong>2.5 Logical Operations</strong><a class="headerlink" href="#25-logical-operations" title="Permanent link">&para;</a></h2>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20111456.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20111456.png" /></a></p>
<h3 id="251-shift-operations-i"><strong>2.5.1 Shift Operations (I)</strong><a class="headerlink" href="#251-shift-operations-i" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20140346.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20140346.png" /></a></p>
<p>immed: how many positions to shift</p>
<p><strong>Shift left logical</strong>: Shift left and fill with 0 bits, <code>slli</code> by i bits multiplies by <span class="arithmatex">\(2^i\)</span></p>
<p><strong>Shift right logical</strong>: Shift right and fill with 0 bits, <code>srli</code> by i bits divides by <span class="arithmatex">\(2^i\)</span> (unsigned only)</p>
<h3 id="252-and-operations"><strong>2.5.2 AND Operations</strong><a class="headerlink" href="#252-and-operations" title="Permanent link">&para;</a></h3>
<p>实现按位与操作</p>
<p>可以用来<strong>保护</strong>某些位，并将其他位清空。</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20140831.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20140831.png" /></a></p>
<h3 id="253-or-operations"><strong>2.5.3 OR Operations</strong><a class="headerlink" href="#253-or-operations" title="Permanent link">&para;</a></h3>
<p>实现按位或的操作</p>
<p>可以用来对一个数的某些位进行<strong>置1</strong>操作，并保持其他位置上是数不变</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20141106.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20141106.png" /></a></p>
<h3 id="254-xor-operations"><strong>2.5.4 XOR Operations</strong><a class="headerlink" href="#254-xor-operations" title="Permanent link">&para;</a></h3>
<p>实现按位异或的操作</p>
<p>可以用来标记两个数不同的位置</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20141307.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20141307.png" /></a></p>
<h3 id="summary_2"><strong>Summary</strong><a class="headerlink" href="#summary_2" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20141428.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-15%20141428.png" /></a></p>
<h2 id="26-instructions-for-making-decisions"><strong>2.6 Instructions for making decisions</strong><a class="headerlink" href="#26-instructions-for-making-decisions" title="Permanent link">&para;</a></h2>
<p><strong>Branch Instructions</strong>: branch to a labled instruction if a condition is true, otherwise, continue sequentially.</p>
<ul>
<li>beq (Branch equal) </li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>beq rs1,rs2,L1  //if (rs1==rs2) branch to instruction labled L1
</code></pre></div>
<ul>
<li>bne (Branch not equal) </li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>bne rs1,rs2,L1  //if (rs1!=rs2) branch to instruction labled L1
</code></pre></div>
<ul>
<li>blt (Branch less than)</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>blt rs1,rs2,L1  //if (rs1&lt;rs2) branch to instruction labled L1
</code></pre></div>
<ul>
<li>bge (Branch greater equal)</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>bge rs1,rs2,L1  //if (rs1&gt;=rs2) branch to instruction labled L1
</code></pre></div>
<p>处理有符号数比较的：blt,bge</p>
<p>处理无符号数比较的：bltu,bgeu</p>
<p>跳转指令介绍见<a href="../RISC-V%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4/">跳转指令</a></p>
<h3 id="261-if"><strong>2.6.1 if 语句</strong><a class="headerlink" href="#261-if" title="Permanent link">&para;</a></h3>
<p>C code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="n">L1</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="nl">L1</span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<p>RISC-V assembly code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>beq  x21, x22, L1 # go to L1 if i equals j
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>add  x19, x20, x21 # f = g + h ( skipped if i equals j )
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>L1: sub x19, x19, x22 # f = f - i ( always executed )
</code></pre></div>
<h3 id="262-if-then-else"><strong>2.6.2 if-then-else 语句</strong><a class="headerlink" href="#262-if-then-else" title="Permanent link">&para;</a></h3>
<p>C code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">else</span><span class="w"> </span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">;</span>
</code></pre></div>
<p>RISC-V assembly code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>bne x22, x23, Else # go to Else if i != j
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>add x19, x20, x21 # f = g + h ( Executed if i = = j 
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>if)
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>beq x0, x0, EXIT # go to Exit if语句执行完直接跳转否则会按顺序执行之后的语句
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>Else: sub x19, x20, x21 # f = g - h ( Executed if i ≠ j 
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>else) 
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>Exit: # the first instruction of the next C
</code></pre></div>
<h3 id="263-while"><strong>2.6.3 While 语句</strong><a class="headerlink" href="#263-while" title="Permanent link">&para;</a></h3>
<p>C code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">save</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">+</span><span class="n">i</span><span class="p">;</span>
</code></pre></div>
<p>RISC-V assembly</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Loop:   slli x10, x22, 3 # temp reg $t1 = 8 * i
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>        add x10, x10, x25 # x10 = address of save[i]
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>        ld x9, 0(x10) # x9 gets save[i] 直接把地址计算出来了
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        bne x9, x24, Exit # go to Exit if save[i] != k
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>        addi x22, x22, 1 # i += 1
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>        beq x0, x0, Loop # go to Loop 
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>Exit:
</code></pre></div>
<h3 id="264-switchcase"><strong>2.6.4 Switch/Case 语句</strong><a class="headerlink" href="#264-switchcase" title="Permanent link">&para;</a></h3>
<p>C code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="cm">/* k = 0 */</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="cm">/* k = 1 */</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="cm">/* k = 2 */</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="cm">/* k = 3 */</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="p">}</span>
</code></pre></div>
<blockquote>
<p>Basic Blocks (基本单元)</p>
<ul>
<li>No embedded branches (except at end)</li>
<li>No branch targets (except at beginning)</li>
</ul>
</blockquote>
<p>RISC-V assembly</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20223330.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20223330.png" /></a></p>
<p>创建了一个跳转表Jumptable，就不用管每一个单位的程序的长度了</p>
<h2 id="27-supporting-procedures"><strong>2.7 Supporting Procedures</strong><a class="headerlink" href="#27-supporting-procedures" title="Permanent link">&para;</a></h2>
<p>procedure/function be used to strcture programs</p>
<ul>
<li>Place Parameters in a place where the procedure can access them 把参数放在一些进程能访问的地方</li>
<li>Transfer control to the procedure：jump to 跳转到相应进程 </li>
<li>Acquire the storage resources needed for the procedure</li>
<li>Perform the desired task</li>
<li>Place the result value in a place where the calling program can access it </li>
<li>Return control to the point of origin</li>
</ul>
<h3 id="procedure-call-instructions"><strong>Procedure Call Instructions</strong><a class="headerlink" href="#procedure-call-instructions" title="Permanent link">&para;</a></h3>
<p>Instruction for procedures: <strong>jal</strong> (jump-and-link)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>jal     x1,ProcedureAddress
</code></pre></div>
<ul>
<li>
<p>Address of following instruction put in x1 把返回后需要执行的指令放在x1，就是<span class="arithmatex">\(PC+4\rightarrow ra\)</span></p>
</li>
<li>
<p>Jumps to target address, 并跳转到子进程的地址</p>
</li>
</ul>
<p>Procedure return: <strong>jalr</strong>(jump and link register)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>jalr    x0,0(x1)
</code></pre></div>
<ul>
<li>
<p>Like jal, but jumps to 0 + address in x1</p>
</li>
<li>
<p>Use x0 as rd (x0 cannot be changed)</p>
</li>
<li>
<p>Can also be used for computed jumps (比如说case/switch statements)</p>
</li>
</ul>
<h3 id="using-more-registers"><strong>Using More Registers</strong><a class="headerlink" href="#using-more-registers" title="Permanent link">&para;</a></h3>
<p><span class="arithmatex">\(a_0\)</span>~<span class="arithmatex">\(a_7\)</span> (<span class="arithmatex">\(x10-x17\)</span>)：八个<strong>参数寄存器</strong>来传参以及<strong>返回值</strong>(x10)的</p>
<p><span class="arithmatex">\(ra/x1\)</span>：储存返回地址的寄存器</p>
<p>但是如果编译器需要超过八个的寄存器，理想的用来处理溢出寄存器的数据结构是堆栈，在RISC-V中Stack pointer被存放在x2中，也被称为sp。同时Stack grow from higher address to lower address。</p>
<div class="admonition example">
<p class="admonition-title">Compling a leaf procedure</p>
<p>C code:
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">leaf_example</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="p">}</span>
</code></pre></div>
RISC-V assembly code:
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>addi sp,sp,-24  //在栈中为这三个项添加三个位置
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>//push
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>sd  x5,16(sp)   //把x5,x6,x20分别存储在栈中的三个位置
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>sd  x6,8(sp)
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>sd  x20,0(sp)
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>//calculate
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>add x5,x10,x11
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>add x6,x12,x13
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>sub x20,x5,x6
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>addi x10,x20,0  //把想要返回的值赋值到x10(a0)中去
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>//pop
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>ld  x20,0(sp)   //还原x5,x6,x20,从栈中把原先存储进去的三个值再取出来
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>ld  x6,8(sp)
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>ld  x5,16(sp)
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>addi sp,sp,24   //还原指针
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>jalr x0,0(x1)   //回到调用该函数的位置
</code></pre></div></p>
</div>
<p>在上面的例子中，我们使用了一个暂时的寄存器并假设之前的值必须被保存的。为了避免保存一些根本不会再用的值，RISC-V将寄存器分为了两种</p>
<ul>
<li><span class="arithmatex">\(x_5-x_7\ and\ x_{28}-x_{31}(t_0-t_6)\)</span>: <strong>temporary register</strong>, by the callee not preserved</li>
<li><span class="arithmatex">\(x_8-x_9\ and\ x_{18}-x_{27}(s_0-s_{11})\)</span>: <strong>saved register</strong>, must be preserved if used</li>
</ul>
<p>下面的例子是一个Nested procedure</p>
<div class="admonition example">
<p class="admonition-title">Compiling a recursive procedure</p>
<p>C code for n!</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">fact</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fact</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="p">}</span>
</code></pre></div>
<p>RISC-V assembly code:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>1    fact:  addi sp, sp, -16    # adjust stack for 2 items 开两个空间
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>2           sd ra, 8(sp)        # save the return address：x1 存放返回地址
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>3           sd a0, 0(sp)        # save the argument n: x10  存放参数n
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>4
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>5           addi t0, a0, -1     # x5 = n - 1    
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>6           bge t0, zero, L1    # if n &gt;= 1, go to L1(else)
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>7           addi a0, zero, 1    # return 1 if n &lt;1
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>8           addi sp, sp, 16     # Recover sp (Why not recover x1and x10 ?)
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>9           jalr zero, 0(ra)    # return to caller
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>10
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>11  L1:     addi a0, a0, -1     # n &gt;= 1: argument gets ( n - 1 )
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>12          jal ra, fact        # call fact with ( n - 1)   跳转到fact语句并改变x0到PC+4
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>13          add t1, a0, zero    # move result of fact(n - 1) to x6(t1)
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>14          ld a0, 0(sp)        # return from jal: restore argument n   找回之前的那个n
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>15          ld ra, 8(sp)        # restore the return address    
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>16          add sp, sp, 16      # adjust stack pointer to pop 2 items
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>17          mul a0, a0, t1      # return n*fact ( n - 1 )
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>18          jalr zero, 0(ra)    # return to the caller
</code></pre></div>
以计算2！为例跑一遍上述代码
设主函数返回的地址为（x1）A，（1，2）后栈中分别是【A，2】，经过（5，6）比较后跳转到（11）将a0改为1，（12）将x1改为了13的地址（B）并跳转到1，然后经过（1，2）后栈中分别是【A，2，B，1】，再经过（5，6，7）后a0改为1，再经过（8）栈中为【A，2】，经过（9）跳转回（13）因为此时x1为B。此时将上一次的返回值给到暂存的寄存器t1，然后经过（14，15）将a0改为之前的2，并修改x1为A，再经过（16），栈清空，经过（17）计算a0为2，经过（18）返回到A。</p>
</div>
<p>在进程调用过程中什么是被保护什么是不被保护的？</p>
<table>
<thead>
<tr>
<th>Preserved</th>
<th>Not preserved</th>
</tr>
</thead>
<tbody>
<tr>
<td>Saved registers: x8-x9, x18-x27</td>
<td>Temporary register: x5-x7,x28-x31</td>
</tr>
<tr>
<td>Stack pointer register: x2(sp)</td>
<td>Argument/result registers: x10-x17</td>
</tr>
<tr>
<td>Frame pointer</td>
<td></td>
</tr>
<tr>
<td>Return address</td>
<td></td>
</tr>
<tr>
<td>Stack above the stack pointer</td>
<td>Stack below thw stack pointer</td>
</tr>
</tbody>
</table>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20201804.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20201804.png" /></a></p>
<h3 id="memory-layout">Memory Layout<a class="headerlink" href="#memory-layout" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-24%20150140.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-24%20150140.png" /></a></p>
<h2 id="28-communicating-with-people-charactor-data"><strong>2.8 Communicating with People Charactor Data</strong><a class="headerlink" href="#28-communicating-with-people-charactor-data" title="Permanent link">&para;</a></h2>
<h3 id="281-some-character-sets"><strong>2.8.1 Some character sets</strong><a class="headerlink" href="#281-some-character-sets" title="Permanent link">&para;</a></h3>
<p><strong>Byte-encoded character sets</strong></p>
<ul>
<li>
<p>ASCII (American Standard Code for Information Interchange) 128 characters：95 graphic, 33 control</p>
</li>
<li>
<p>Latin-1: 256 characters 相比于ASCII, +96 more graphic characters</p>
</li>
</ul>
<p><strong>Unicode: 32-bit character set</strong></p>
<ul>
<li>
<p>Used in Java, C++ wide characters, …</p>
</li>
<li>
<p>Most of the world’s alphabets, plus symbols</p>
</li>
<li>
<p>UTF-8, UTF-16: variable-length encodings</p>
</li>
</ul>
<h3 id="282-risc-v-bytehalfwordword-loadstore"><strong>2.8.2 RISC-V byte/halfword/word load/store</strong><a class="headerlink" href="#282-risc-v-bytehalfwordword-loadstore" title="Permanent link">&para;</a></h3>
<ul>
<li>Load byte/halfword/word: Sign extend to 64 bits in rd</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>lb rd, offset(rs1)
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>lh rd, offset(rs1)
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>lw rd, offset(rs1)
</code></pre></div>
<ul>
<li>Load byte/halfword/word <strong>unsigned</strong>: 0 extend to 64 bits in rd</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>lbu rd, offset(rs1)
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>lhu rd, offset(rs1)
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>lwu rd, offset(rs1)
</code></pre></div>
<ul>
<li><strong>Store</strong> byte/halfword/word: Store rightmost 8/16/32 bits</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>sb rs2, offset(rs1)
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>sh rs2, offset(rs1)
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>sw rs2, offset(rs1)
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">String Copy Example</p>
<p>C code
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">strcpy</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="err">‘\</span><span class="w"> </span><span class="mi">0</span><span class="err">’</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="cm">/* copy and test byte */</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="p">}</span>
</code></pre></div>
RISC-V assembly code:
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>strcpy: addi sp, sp, -8 # adjust stack for 1 doubleword
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>        sd x19, 0(sp) # save x19
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>        add x19, x0, x0 # i = 0 
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    L1: add x5, x19, x11 # x5 = address of y[ i]
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>        lbu x6, 0(x5) # x6 = y [ i ]
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>        add x7, x19, x10 # x7 = address of x[ i ] 
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>        sb x6, 0(x7) # x[ i ] = y[ i ]
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>        beq x6, x0, L2 # if y[i] == 0 then exit
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>        addi x19, x19, 1 # i = i + 1
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>        jal x0, L1 # next iteration of loop
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>    L2: ld x19, 0(sp) # restore saved old s3
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>        addi sp, sp, 8 # pop 1 double word from stack
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>        jalr zero 0(x1) # return
</code></pre></div></p>
</div>
<h2 id="29-addressing-for-32-bit-immediate-and-addresses"><strong>2.9 Addressing for 32-bit Immediate and Addresses</strong><a class="headerlink" href="#29-addressing-for-32-bit-immediate-and-addresses" title="Permanent link">&para;</a></h2>
<h3 id="291-addressing-for-32-bit-immediate"><strong>2.9.1 Addressing for 32-bit Immediate</strong><a class="headerlink" href="#291-addressing-for-32-bit-immediate" title="Permanent link">&para;</a></h3>
<p>大多常数都不超过12位，但有些时候会取一些大数。</p>
<p>我们可以利用RISC-V的其中一条指令 <em>Load upper immediate</em> (lui)来设置一个32-bit constant</p>
<p><strong>U-type</strong></p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20211749.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20211749.png" /></a></p>
<div class="admonition example">
<p class="admonition-title">Loading a 32-bit constant</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20212534.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20212534.png" /></a>
要注意的是addi计算的是有符号数，所以计算时先进行了sign extended然后再与lui后的结果相加，然后再加上<span class="arithmatex">\(2^{12}\)</span>修正问题。</p>
</div>
<h3 id="292-branch-addressing"><strong>2.9.2 Branch Addressing</strong><a class="headerlink" href="#292-branch-addressing" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20214029.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20214029.png" /></a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>bne rs1 rs2 offset
</code></pre></div>
<p>对于汇编来说的offset与在机器码中的immediate呈现一个2倍关系，因为offset必然为偶数（尽管是4的倍数但是只省略1位的原因是RISC-V的发明者希望能兼容16位的系统）</p>
<div class="admonition example">
<p class="admonition-title">Branch offset</p>
<p>C code
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">while</span><span class="p">(</span><span class="n">save</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="err">；</span>
</code></pre></div>
RISC-V assembly code
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>Loop:   slli x10, x22, 3    # temp reg x10 = 8 * i
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>        add x10, x10, x25   # x10 = address of save[i]
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>        ld x9, 0(x10)       # temp reg x9 = save[i]
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>        bne x9, x24, Exit   # go to Exit if save[i] != k
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>        addi x22, x22, 1    # i = i + 1
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>        beq x0, x0, Loop    # go to Loop
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>Exit:
</code></pre></div>
如果写数值的话第一个Exit为12，第二个Loop为-20
<a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20220840.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20220840.png" /></a></p>
</div>
<p>如果有条件跳转需要跳到更远的地方，那么可以将其转化到无条件跳转来处理</p>
<p>比如说：Given a branch: <code>beq    x10,x0,L1</code></p>
<p>可以把它改写为</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>    bne x10, x0, L2
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>    jal x0, L1
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>L2:
</code></pre></div>
<p>这样跳转的距离从12位增加到了20位，当然还可以结合lui升到32位。</p>
<h3 id="293-jump-addressing"><strong>2.9.3 Jump Addressing</strong><a class="headerlink" href="#293-jump-addressing" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20215034.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-17%20215034.png" /></a></p>
<p>jal可以跳转小范围，如果需要大范围跳转，可以先使用lui到temp register然后使用jalr加上immed即可。</p>
<h3 id="294-risc-v-addressing-summary"><strong>2.9.4 RISC-V Addressing Summary</strong><a class="headerlink" href="#294-risc-v-addressing-summary" title="Permanent link">&para;</a></h3>
<p>四种寻址方式：</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101317.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101317.png" /></a></p>
<h2 id="210-risc-v-disassembly"><strong>2.10 RISC-V Disassembly</strong><a class="headerlink" href="#210-risc-v-disassembly" title="Permanent link">&para;</a></h2>
<div class="admonition example">
<p class="admonition-title">Decoding machine code</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101550.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101550.png" /></a></p>
</div>
<h3 id="summary-of-risc-v-instruction-encoding"><strong>Summary of RISC-V instruction encoding</strong><a class="headerlink" href="#summary-of-risc-v-instruction-encoding" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101745.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101745.png" /></a></p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101712.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101712.png" /></a></p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101731.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20101731.png" /></a></p>
<h2 id="211-synchronization-in-risc-v"><strong>2.11 Synchronization in RISC-V</strong><a class="headerlink" href="#211-synchronization-in-risc-v" title="Permanent link">&para;</a></h2>
<p>现在的计算机多为多处理器，但这些处理器都共用一片内存，这样就会产生竞争。我们使用指令对来解决这一个问题：</p>
<p>Load reserved: <code>lr.w/d rd,(rs1)</code></p>
<ul>
<li>Load from address in rs1 to rd</li>
<li>Place reservation on memory address</li>
</ul>
<p>lr 指令是从内存地址 rs1 中加载内容到 rd 寄存器。然后在 rs1 对应地址上设置保留标记(reservation set)。其中 w/d 分别对应 32 位/64 位版本。</p>
<p>Store conditional: <code>sc.w/d rd,rs2,(rs1)</code></p>
<ul>
<li>Store from rs2 to address in rs1 </li>
<li>Succeeds if location not changed since the lr.d, then returns 0 in rd</li>
<li>Fails if location is changed then returns non-zero value in rd</li>
</ul>
<p>sc 指令在把 rs2 值写到 rs1 地址之前，会先判断 rs1 内存地址是否有设置保留标记，如果设置了，则把 rs2 值正常写入到 rs1 内存地址里，并把 rd 寄存器设置成 0，表示保存成功。如果 rs1 内存地址没有设置保留标记，则不保存，并把 rd 寄存器设置成 1 表示保存失败。不管成功还是失败，sc 指令都会把当前 hart 保留的所有保留标记全部清除。其中 w/d 分别对应 32 位/64 位版本。</p>
<div class="admonition example">
<p class="admonition-title">atomic swap</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>again: lr.d x10,(x20)
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>sc.d x11,(x20),x23 // X11 = status
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>bne x11,x0,again // branch if store failed
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>addi x23,x10,0 // X23 = loaded value
</code></pre></div>
目标是将寄存器x20中指定的内存位置上的值与x23之间的值进行交换，x10是中间寄存器，x11为状态寄存器</p>
</div>
<div class="admonition example">
<p class="admonition-title">lock and unlock</p>
<p>Lock
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>        addi x12,x0,1 // copy locked value
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>again:  lr.d x10,(x20) // read lock
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>        bne x10,x0,again // check if it is 0 yet
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>        sc.d x11,x12,(x20) // attempt to store
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>        bne x11,x0,again // branch if fails
</code></pre></div>
Unlock:
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>    sd x0,0(x20) // free lock
</code></pre></div></p>
</div>
<h2 id="212-translating-and-starting-a-program"><strong>2.12 Translating and starting a program</strong><a class="headerlink" href="#212-translating-and-starting-a-program" title="Permanent link">&para;</a></h2>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20105052.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20105052.png" /></a></p>
<h3 id="2121-assembler"><strong>2.12.1 Assembler</strong><a class="headerlink" href="#2121-assembler" title="Permanent link">&para;</a></h3>
<p>pseudoinstructions（伪指令）: 汇编指令的变体，硬件不需要实现这些指令，是为了建委程序转换与编程的。</p>
<p>比如说RISC-V汇编器可以识别</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>li  x9,123      //load immediate value 123 into register x9
</code></pre></div>
<p>汇编器会将此汇编语言转换成以下机器语言</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>addi x9,x0,123  //register x9 gets register x0+123
</code></pre></div>
<p>同样的，汇编器可以识别<code>mv</code>并将其转化</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>mv  x10,x11     //register x10 gets register x11
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>变为
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>addi x10,x11,0
</code></pre></div>
<p>汇编器还接受<code>j label</code>作为<code>jal x0,Label</code>替代，并且汇编器还允许大常量加载导寄存器中，尽管立即数指令位数有限。</p>
<p>最后，它可以通过确定程序员想要的指令变体来简化指令系统。例如，算术和逻辑指令使用常量时，RISC-V汇编器不要求程序员指定指令的立即数版本，它只是生成正确的操作码。从而将</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>and x9,x10,15
</code></pre></div>
<p>变为</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>andi x9,x10,15
</code></pre></div>
<p>汇编器最终将汇编语言转换成目标文件，是机器指令、数据和将指令正确放入内存所需信息的组合</p>
<p>UNIX系统的目标文件通常包含六个部分</p>
<ul>
<li>
<p>Header: described contents of object module</p>
</li>
<li>
<p>Text segment: translated instructions</p>
</li>
<li>
<p>Static data segment: data allocated for the life of the program</p>
</li>
<li>
<p>Relocation info: for contents that depend on absolute location of loaded program</p>
</li>
<li>
<p>Symbol table: global definitions and external refs</p>
</li>
<li>
<p>Debug info: for associating with source code</p>
</li>
</ul>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20155159.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20155159.png" /></a></p>
<h3 id="2122-linker"><strong>2.12.2 Linker</strong><a class="headerlink" href="#2122-linker" title="Permanent link">&para;</a></h3>
<p>Object modules(including library routine) → <strong>executable program</strong></p>
<p>分为三个步骤</p>
<ul>
<li>
<p>Place code and data modules symbolically in memory</p>
</li>
<li>
<p>Determine the addresses of data and instruction labels</p>
</li>
<li>
<p>Patch both the internal and external references (<strong>Address of invoke</strong>)</p>
</li>
</ul>
<h3 id="2123-loader"><strong>2.12.3 Loader</strong><a class="headerlink" href="#2123-loader" title="Permanent link">&para;</a></h3>
<p>现在可执行文件在磁盘上，操作系统将其读取到内存并启动它。加载器在UNIX系统中遵循以下步骤：</p>
<p>1.读取可执行文件首部以确定正文段和数据段的大小。</p>
<p>2.为正文和数据创建足够大的地址空间。</p>
<p>3.将可执行文件中的指令和数据复制到内存中。</p>
<p>4.将主程序的参数(如果有)复制到栈顶。</p>
<p>5.初始化处理器寄存器并将栈指针指向第一个空闲位置。</p>
<p>6.跳转到启动例程，将参数复制到参数寄存器中并调用程序的主例程。当主例程返回时，启动例程通过exit系统调用终止程序。</p>
<h3 id="2124-dynamic-linking"><strong>2.12.4 Dynamic Linking</strong><a class="headerlink" href="#2124-dynamic-linking" title="Permanent link">&para;</a></h3>
<p>Only link/load library procedure when it is called</p>
<p>在DLL最初版本中，加载器运行一个动态链接程序，使用文件中的额外信息来查找相应的库并更新所有外部应用。但是它仍然链接；1可能调用的库的所有历程，而不是程序运行期间的那些例程。</p>
<p>现在介绍DLL的延迟过程链接版本（Lazy linkage) 其中每个例程仅在被调用后才链接。</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20193526.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20193526.png" /></a></p>
<p>第一次调用库例程时，程序调用虚入口并执行<strong>间接跳转</strong>。这个跳转指向一段代码，它将一个数字放入寄存器来识别所需的库例程，然后跳转到动态链接器/加载器。链接器/加载器找到所需的例程，重新映射它，并更改间接跳转位置中的地址以指向该例程。然后跳转到这个例程。例程完成后，它将返回到初始调用点。此后，它都会间接跳转到该例程而不需额外的中间过程。</p>
<p>总之，DLL需要额外的空间来存储动态链接所需的信息，但不要求复制或链接整个库。它们在第一次调用例程时会付出大量的开销，但此后只需一个间接跳转。请注意，从库返回不会产生额外的开销。</p>
<h3 id="2125-starting-java-applications"><strong>2.12.5 Starting Java Applications</strong><a class="headerlink" href="#2125-starting-java-applications" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20195625.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20195625.png" /></a></p>
<p>就是java开发出来的目标是适用于任何计算机。所以java增加了一个JVM（Java virtual Machine) 的东西。编译器先将java编译成易于解释的指令：Java字节码 (Java Bytecode) 指令系统，编译速度比较快，然后通过JVM将Java字节码再进行转换。</p>
<p>优点是可移植性，缺点是速度慢</p>
<h2 id="213-arrays-versus-pointers"><strong>2.13 Arrays versus Pointers</strong><a class="headerlink" href="#213-arrays-versus-pointers" title="Permanent link">&para;</a></h2>
<p><strong>Array indexing involves</strong></p>
<ul>
<li>
<p>Multiplying index by element size 计算偏移量</p>
</li>
<li>
<p>Adding to array base address 添加到基地址上</p>
</li>
</ul>
<p><strong>Pointers correspond directly to memory addresses</strong></p>
<ul>
<li>Can avoid indexing complexity</li>
</ul>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20200642.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20200642.png" /></a></p>
<h2 id="214-real-stuff"><strong>2.14* Real Stuff</strong><a class="headerlink" href="#214-real-stuff" title="Permanent link">&para;</a></h2>
<h3 id="2141-mips-instructions"><strong>2.14.1 MIPS Instructions</strong><a class="headerlink" href="#2141-mips-instructions" title="Permanent link">&para;</a></h3>
<p>MIPS: commercial predecessor to RISC-V</p>
<p>Similar basic set of instructions</p>
<ul>
<li>
<p>32-bit instructions</p>
</li>
<li>
<p>32 general purpose registers, register 0 is always 0</p>
</li>
<li>
<p>32 floating-point registers</p>
</li>
<li>
<p>Memory accessed only by load/store instructions, consistent use of addressing modes for all data sizes</p>
</li>
</ul>
<p>Different conditional branches for &lt;, &lt;=, &gt;, &gt;=</p>
<ul>
<li>
<p>RISC-V: blt, bge, bltu, bgeu</p>
</li>
<li>
<p>MIPS: slt, sltu (set less than, result is 0 or 1), Then use beq, bne to complete the branch</p>
</li>
</ul>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20201130.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20201130.png" /></a></p>
<h3 id="2142-the-intel-x86-isa"><strong>2.14.2 The Intel x86 ISA</strong><a class="headerlink" href="#2142-the-intel-x86-isa" title="Permanent link">&para;</a></h3>
<p>这是一种CISC的指令集类型，尽可能减少指令的数量，增加不同的指令。</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20202901.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20202901.png" /></a></p>
<p><strong>x86寄存器</strong></p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20201316.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20201316.png" /></a></p>
<p><strong>x86算术和逻辑指令</strong>中必须有一个操作数<strong>既作为源操作数，又作为目的操作数</strong>；RISC-V和MIPS允许源和目的操作数的寄存器分开。x86的这种限制对有限寄存器带来了更大的压力，因为必须修改一个源寄存器。第二个重要的区别在于其中一个操作数可以在存储器中。因此，与RISC-V和MIPS不同，实际上任何指令都可能有一个操作数在存储器中。</p>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20202104.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20202104.png" /></a></p>
<p>同时x86的指令解码也比较复杂，指令长度不一，从很短到很长，解码比较困难。</p>
<h3 id="2143-other-risc-v-instructions"><strong>2.14.3 Other RISC-V Instructions</strong><a class="headerlink" href="#2143-other-risc-v-instructions" title="Permanent link">&para;</a></h3>
<p><strong>Base integer instructions (RV64I)</strong></p>
<ul>
<li>Those previously described, plus</li>
<li><code>auipc rd, immed // rd = (imm&lt;&lt;12) + pc</code>, follow by jalr (adds 12-bit immed) for long jump，与lui很像</li>
<li><code>slt, sltu, slti, sltui</code>: set less than (like MIPS)</li>
<li><code>addw, subw, addiw</code>: 32-bit add/sub</li>
<li><code>sllw, srlw, srlw, slliw</code>, srliw, sraiw: 32-bit shift</li>
</ul>
<p><strong>32-bit variant: RV32I</strong></p>
<ul>
<li>registers are 32-bits wide, 32-bit operations</li>
</ul>
<p><strong>Instruction Set Extensions</strong> (指令集的扩张)</p>
<ul>
<li>
<p>M: integer multiply, divide, remainder</p>
</li>
<li>
<p>A: atomic memory operations</p>
</li>
<li>
<p>F: single-precision floating point</p>
</li>
<li>
<p>D: double-precision floating point</p>
</li>
<li>
<p>C: compressed instructions: 16-bit encoding for frequently used instructions</p>
</li>
</ul>
<h2 id="215-a-c-sort-example-to-put-it-all-together"><strong>2.15 A C Sort Example To Put it All Together</strong><a class="headerlink" href="#215-a-c-sort-example-to-put-it-all-together" title="Permanent link">&para;</a></h2>
<h3 id="2151-procedure-swap"><strong>2.15.1 Procedure <em>swap</em></strong><a class="headerlink" href="#2151-procedure-swap" title="Permanent link">&para;</a></h3>
<p><strong>C code</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">swap</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="p">{</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">    </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">    </span><span class="n">v</span><span class="p">[</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">    </span><span class="n">v</span><span class="p">[</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Register allocation for <em>swap</em></strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>v ---- x10 k ---- x11 temp ---- x5
</code></pre></div>
<p><em>swap</em> is a leaf procedure, nothing to preserve</p>
<p><strong>RISC-V code for the procedure <em>swap</em></strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>swap: slli x6, x11, 3 // x6 = k * 8 
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>add x6, x10, x6 // x6 = v + ( k * 8 )
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>ld x5, 0(x6) // x5 ← v[ k ]
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>ld x7, 8(x6) // x7 ← v[ k + 1 ] 
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>sd x7, 0(x6) // v[k+1] → v[ k ]
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>sd x5, 8(x6) // v[k] → v[ k + 1 ]
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>jalr x0, 0(x1) // return to calling routine
</code></pre></div>
<h3 id="2152-procedure-sort">2.15.2 Procedure <em>sort</em><a class="headerlink" href="#2152-procedure-sort" title="Permanent link">&para;</a></h3>
<p><strong>C code</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">sort</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="p">{</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">    </span><span class="n">swap</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">;</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Register allocation</strong> for <em>sort</em></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>v ---- x10 n ---- x11 i ---- x19 j ---- x20
</code></pre></div>
<p><strong>Passing parameters</strong> in <em>sort</em></p>
<p><strong>Preserving registers</strong> in <em>sort</em></p>
<p>x1, x19, x20, x21, x22</p>
<h4 id="the-outer-loop"><strong>The Outer Loop</strong><a class="headerlink" href="#the-outer-loop" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>li x19,0 // i = 0
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>for1tst:
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>    bge x19,x11,exit1 // go to exit1 if x19 ≥ x11 (i≥n)
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>    (body of outer for-loop)
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>    addi x19,x19,1 // i += 1
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>    j for1tst // branch to test of outer loop
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>exit1:
</code></pre></div>
<h4 id="the-inner-loop"><strong>The Inner Loop</strong><a class="headerlink" href="#the-inner-loop" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>addi x20,x19,-1 // j = i −1
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>for2tst: 
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>    blt x20,x0,exit2 // go to exit2 if X20 &lt; 0 (j &lt; 0)
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>    slli x5,x20,3 // reg x5 = j * 8
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>    add x5,x10,x5 // reg x5 = v + (j * 8)
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>    ld x6,0(x5) // reg x6 = v[j]
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>    ld x7,8(x5) // reg x7 = v[j + 1]
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>    ble x6,x7,exit2 // go to exit2 if x6 ≤ x7
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>    mv x10, x21 // first swap parameter is v
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>    mv x11, x20 // second swap parameter is j
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>    jal x1,swap // call swap
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>    addi x20,x20,-1 // j –= 1
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>    j for2tst // branch to test of inner loop
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>exit2:
</code></pre></div>
<h3 id="2153-the-full-procedure"><strong>2.15.3 The Full Procedure</strong><a class="headerlink" href="#2153-the-full-procedure" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20210714.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="../img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202024-10-22%20210714.png" /></a></p>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        此页面有帮助吗？
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9h4m4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21H9m0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03V19Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12h-4M15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3h9m0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97V5Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              谢谢你的反馈！
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by using our <a href="https://marketingplatform.google.com/about/analytics/" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


  <h2 id="__comments">评论</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
    data-repo="RoderickShao/RoderickShao_notebook"
    data-repo-id="R_kgDOMS_5AQ"
    data-category="Announcements"
    data-category-id="DIC_kwDOMS_5Ac4Cjs7e"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    crossorigin="anonymous"
    async>
  </script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            回到页面顶部
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../Chapter%201/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 1 Chapter 1" rel="prev">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                1 Chapter 1
              </div>
            </div>
          </a>
        
        
          
          <a href="../Chapter%203/" class="md-footer__link md-footer__link--next" aria-label="下一页: 3 Chapter 3" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                3 Chapter 3
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 - 2024 RoderickShao
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.prune", "navigation.tracking", "navigation.indexes", "navigation.tracking", "navigation.top", "navigation.footer", "header.autohide", "search.highlight", "search.share", "search.suggest", "content.code.copy", "content.code.annotate", "material.extensions.emoji.twemoji"], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.4e31edb1.min.js"></script>
      
        
          <script src="../../../javascripts/mathjax.js"></script>
        
      
        
          <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
        
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>